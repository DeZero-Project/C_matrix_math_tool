# 要件定義書：行列計算ツール (C-DeZero Backend)

## 1. 目的
* 外部ライブラリ（OpenBLAS, MKL等）に一切依存せず、C言語標準ライブラリのみで完結する高性能行列演算ライブラリを開発する
* DeZero（ディープラーニングフレームワーク）の全機能をC言語で再現するための基礎とする
* 学習および移植性を最大化するため、バイナリ配布ではなくソースコードレベルでの完全な自己完結を目指す

## 2. 機能要件

### 2.1 基本演算・多次元配列サポート
* [ ] **多次元配列（ND-Array）のサポート**: 2次元（行列）に限らず、N次元テンソルを扱えるデータ構造の実装
* [ ] **ストライド（Strides）管理**: メモリコピーを伴わない転置（View）やスライシングを実現するためのストライド演算の実装
* [ ] **基本演算**: 加算、減算、乗算、除算（要素ごとの演算）
* [ ] **ブロードキャスト機能**: NumPy準拠の形状（Shape）の異なる配列間での自動演算
* [ ] **単項演算**: 転置（Transpose）、スカラー倍、軸の入れ替え（Permute/Swapaxes）

### 2.2 数学関数・統計演算
* [ ] **要素ごとの数学関数**: `exp`, `log`, `tanh`, `sigmoid`, `pow` 等（math.hを活用）
* [ ] **集計演算**: 軸（Axis）を指定した `sum`, `mean`, `max`, `min` の計算、および次元維持（keepdims）のサポート
* [ ] **特殊演算**: ノルム計算（L1/L2）、行列式（Determinant）

### 2.3 形状操作・初期化
* [ ] **形状操作**: `reshape`, `flatten`, `squeeze`, `unsqueeze`
* [ ] **初期化アルゴリズム**: ゼロ初期化、単位行列、および再現性のあるアルゴリズム（Xorshift等）を用いた重み初期化（He/Xavier）

### 2.4 入出力
* [ ] **表示・保存**: 計算結果の標準出力およびファイル（バイナリ/テキスト）への保存・読み込み

## 3. 非機能要件

### 3.1 パフォーマンス
* **メモリレイアウト**: キャッシュ効率最大化のため、行優先（Row-major）レイアウトを基本とする
* **キャッシュ最適化**: CPUキャッシュ効率を最大化するメモリアクセスパターン（ブロック化アルゴリズム等）の実装
* **計算精度の柔軟性向上**: Typedefを用いてfloatとdoubleの切り替えを容易に行う機能の実装
* **並列処理**: 標準CおよびOS標準機能（pthreads等）の範囲内でのマルチスレッド化検討
* **メモリアライメント**: SIMD命令（AVX/NEON等）をコンパイラが自動適用しやすいよう、メモリアドレスを境界整合させる設計

### 3.2 メモリ管理
* **カスタムメモリアロケータ**: `malloc/free` の頻出を避けるためのプール管理の実装
* **データ構造の拡張性**: DeZeroの計算グラフ構築を見据え、勾配（grad）情報やメタデータを保持可能な構造体設計
* **動的確保の最小化**: 計算グラフ実行時のメモリ再利用（Memory Reuse）を考慮した設計

### 3.3 移植性・依存性
* **ゼロ依存性**: `stdio.h`, `stdlib.h`, `math.h`, `string.h`, `time.h` のみを使用
* **環境不問**: Linux, Windows, macOS および埋め込み環境でもコンパイル可能であること

## 4. 制約事項
* **外部ライブラリ禁止**: OpenBLAS, LAPACK, Eigen 等の外部数学ライブラリは使用しない
* **標準準拠**: C99規格（またはC11）に準拠し、特殊なコンパイラ拡張に依存しない